(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{333:function(_,t,a){"use strict";a.r(t);var v=a(7),e=Object(v.a)({},(function(){var _=this,t=_._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"性能优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#性能优化"}},[_._v("#")]),_._v(" 性能优化")]),_._v(" "),t("p",[_._v("本文主要考虑客户端性能、服务器端和网络性能，内容框架来自"),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.yahoo.com%2Fperformance%2Frules.html%3Fguccounter%3D1",target:"_blank",rel:"noopener noreferrer"}},[_._v("Yahoo Developer Network"),t("OutboundLink")],1),_._v("，包含 7 个类别共 35 条前端性能优化最佳实践，在此基础上补充了一些相关或者更符合主流技术的内容。")]),_._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.staticaly.com/gh/jlk-lebron/blog-img@main/PicGo/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.webp",alt:""}})]),_._v(" "),t("p",[_._v("前端性能的一个重要指标是页面加载时间，不仅事关用户体验，也是搜索引擎排名考虑的一个因素。")]),_._v(" "),t("ul",[t("li",[_._v("来自Google的数据表明，一个有10条数据0.4秒能加载完的页面，变成30条数据0.9秒加载完之后，流量和广告收入下降90%。")]),_._v(" "),t("li",[_._v("Google Map 首页文件大小从100KB减小到70-80KB后，流量在第一周涨了10%，接下来的三周涨了25%。")]),_._v(" "),t("li",[_._v("亚马逊的数据表明：加载时间增加100毫秒，销量就下降1%。")])]),_._v(" "),t("p",[_._v("以上数据更说明「加载时间就是金钱」，前端优化主要围绕提高加载速度进行。")]),_._v(" "),t("h1",{attrs:{id:"一、页面内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、页面内容"}},[_._v("#")]),_._v(" 一、页面内容")]),_._v(" "),t("h2",{attrs:{id:"_1-减少http请求数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-减少http请求数"}},[_._v("#")]),_._v(" （1）减少HTTP请求数")]),_._v(" "),t("p",[_._v("Web 前端 80% 的响应时间花在图片、样式、脚本等资源下载上。最直接的方式是减少页面所需资源，但并不现实。所以，减少HTTP请求数主要的途径是：")]),_._v(" "),t("blockquote",[t("p",[_._v("合并JS/CSS文件。服务器端（CDN）自动合并，基于Node.js的文件合并工具，通过把所有脚本放在一个文件中的方式来减少请求数。")]),_._v(" "),t("p",[_._v("使用"),t("strong",[_._v("CSS")]),_._v(" "),t("strong",[_._v("Sprite")]),_._v("将背景图片合并成一个文件，通过 "),t("code",[_._v("background-image")]),_._v(" 和 "),t("code",[_._v("background-position")]),_._v(" 控制显示")]),_._v(" "),t("p",[t("strong",[_._v("行内图片")]),_._v("（Base64编码）。使用Data URI scheme将图片嵌入HTML或者CSS中；或者将CSS、JS、图片直接嵌入HTML中，会增加文件大小，也可能产生浏览器兼容及其他性能问题。")])]),_._v(" "),t("p",[_._v("减少页面的HTTP请求数是个起点，这是提升站点首次访问速度的重要指导原则。")]),_._v(" "),t("h2",{attrs:{id:"_2-减少dns查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-减少dns查询"}},[_._v("#")]),_._v(" （2）减少DNS查询")]),_._v(" "),t("p",[_._v("用户输入URL以后，浏览器首先要查询域名（hostname）对应服务器的IP地址，一般需要耗费20-120毫秒时间。DNS查询完成之前，浏览器无法从服务器下载任何数据。")]),_._v(" "),t("p",[_._v("基于性能考虑，ISP、局域网、操作系统、浏览器都会有相应的DNS缓存机制。")]),_._v(" "),t("ul",[t("li",[_._v("IE缓存30分钟，可以通过注册表中DnsCacheTimeout项设置；")]),_._v(" "),t("li",[_._v("Firefox缓存1分钟，通过network.dnsCacheExpiration配置；")])]),_._v(" "),t("p",[_._v("另外减少不同的主机名可减少DNS查找，减少不同主机名的数量同时也减少了页面能够并行下载的组件数量，避免DNS查找削减了响应时间，而减少并行下载数量却增加了响应时间。原则是把组件分散在2到4个主机名下，这是同时减少DNS查找和允许高并发下载的折中方案。")]),_._v(" "),t("h2",{attrs:{id:"_3-避免重定向"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-避免重定向"}},[_._v("#")]),_._v(" （3）避免重定向")]),_._v(" "),t("p",[_._v("HTTP重定向通过 "),t("code",[_._v("301/302")]),_._v("状态码实现。下面是一个有301状态码的HTTP头")]),_._v(" "),t("div",{staticClass:"language-Apache extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[_._v("apache\n复制代码\n HTTP/1.1 301 Moved Permanently  Location: http://example.com/newuri Content-Type: text/html\n")])])]),t("p",[_._v("浏览器会自动跳转到Location域指明的URL。重定向需要的所有信息都在HTTP头部，而响应体一般是空的。其实额外的HTTP头，比如Expires和Cache-Control也表示重定向。除此之外还有别的跳转方式：refresh元标签和JavaScript，但如果你必须得做重定向，最好用标准的3xxHTTP状态码，主要是为了让返回按钮能正常使用。")]),_._v(" "),t("p",[_._v("客户端收到服务器的重定向响应后，会根据响应头中Location的地址再次发送请求。重定向会影响用户体验，尤其是多次重定向时，用户在一段时间内看不到任何内容，只看到浏览器进度条一直在刷新。")]),_._v(" "),t("ul",[t("li",[_._v("最浪费的重定向经常发生、而且很容易被忽略：URL 末尾应该添加 "),t("code",[_._v("/")]),_._v("但未添加。比如，访问 "),t("code",[_._v("http://astrology.yahoo.com/astrology")]),_._v("将被 "),t("code",[_._v("301")]),_._v("重定向到 "),t("code",[_._v("http://astrology.yahoo.com/astrology/")]),_._v("（注意末尾的 /）。如果使用 Apache，可以通过Alias或mod_rewrite或DirectorySlash解决这个问题。")]),_._v(" "),t("li",[_._v("网站域名变更：CNAME结合Alias或mod_rewrite或者其他服务器类似功能实现跳转。")])]),_._v(" "),t("h2",{attrs:{id:"_4-缓存ajax请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-缓存ajax请求"}},[_._v("#")]),_._v(" （4）缓存Ajax请求")]),_._v(" "),t("p",[_._v("最重要的的优化方式是缓存响应结果。有尚未过期的Expires或者Cache-Control HTTP头，那么之前的资源就可以从缓存中读出。必须通知浏览器，应该继续使用之前缓存的资源响应，还是去请求一个新的。可以通过给资源的Ajax URL里添加一个表明用户资源最后修改时间的时间戳来实现。如果资源从上一次下载之后再没有被修改过，时间戳不变，资源就将从浏览器缓存中直接读出，从而避免一次额外的HTTP往返消耗。详见 "),t("code",[_._v("服务器-添加Expires或Cache响应头")]),_._v("。")]),_._v(" "),t("h2",{attrs:{id:"_5-延迟加载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-延迟加载"}},[_._v("#")]),_._v(" （5）延迟加载")]),_._v(" "),t("p",[_._v("页面初始加载时哪些内容是绝对必需的？不在答案之列的资源都可以延迟加载。比如：")]),_._v(" "),t("ul",[t("li",[_._v("非首屏使用的数据、样式、脚本、图片等；")]),_._v(" "),t("li",[_._v("用户交互时才会显示的内容。")])]),_._v(" "),t("p",[_._v("遵循「渐进增强」理念开发的网站：JavaScript用于增强用用户体验，但没有（不支持） JavaScript也能正常工作，完全可以延迟加载JavaScript。")]),_._v(" "),t("blockquote",[t("p",[_._v("将首屏以外的HTML放在不渲染的元素中，如隐藏的 "),t("code",[_._v("<textarea>")]),_._v("，或者type属性为非执行脚本的 "),t("code",[_._v("<script>")]),_._v("标签中，减少初始渲染的DOM元素数量，提高速度。等首屏加载完成或者用户操作时，再去渲染剩余的页面内容。")])]),_._v(" "),t("h2",{attrs:{id:"_6-预加载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-预加载"}},[_._v("#")]),_._v(" （6）预加载")]),_._v(" "),t("p",[_._v("预先加载利用浏览器空闲时间请求将来要使用的资源，以便用户访问下一页面时更快地响应。")]),_._v(" "),t("ul",[t("li",[_._v("无条件预先加载：页面加载完成（load）后，马上获取其他资源。以 "),t("a",{attrs:{href:"https://link.juejin.cn/?target=http%3A%2F%2Fgoogle.com",target:"_blank",rel:"noopener noreferrer"}},[_._v("google.com"),t("OutboundLink")],1),_._v(" 为例，首页加载完成后会立即下载一个 Sprite 图片，此图首页不需要，但是搜索结果页要用到。")]),_._v(" "),t("li",[_._v("有条件预先加载：根据用户行为预判用户去向，预载相关资源。比如search.yahoo.com开始输入时会有额外的资源加载。Chrome 等浏览器的地址栏也有类似的机制。")]),_._v(" "),t("li",[_._v("有「阴谋」的预先加载：页面即将上线新版前预先加载新版内容。网站改版后由于缓存、使用习惯等原因，会有旧版的网站更快更流畅的反馈。为缓解这一问题，在新版上线之前，旧版可以利用空闲提前加载一些新版的资源缓存到客户端，以便新版正式上线后更快的载入。")])]),_._v(" "),t("h2",{attrs:{id:"_7-减少dom元素数量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-减少dom元素数量"}},[_._v("#")]),_._v(" （7）减少DOM元素数量")]),_._v(" "),t("p",[_._v("复杂的页面不仅下载的字节更多，JavaScript DOM操作也更慢。例如，同是添加一个事件处理器，500个元素和5000个元素的页面速度上会有很大区别。")]),_._v(" "),t("p",[_._v("从以下几个角度考虑移除不必要的标记：")]),_._v(" "),t("ul",[t("li",[_._v("是否还在使用表格布局？")]),_._v(" "),t("li",[_._v("塞进去更多的 "),t("code",[_._v("<div>")]),_._v("仅为了处理布局问题？也许有更好、更语义化的标记。")]),_._v(" "),t("li",[_._v("能通过伪元素实现的功能，就没必要添加额外元素，如清除浮动。")])]),_._v(" "),t("p",[_._v("浏览器控制台中输入以下代码可以计算出页面中有多少 DOM 元素：")]),_._v(" "),t("blockquote",[t("p",[_._v("document.getElementsByTagName('*').length;")])]),_._v(" "),t("p",[_._v("为什么不使用表格布局？")]),_._v(" "),t("ul",[t("li",[_._v("更多的标签，增加文件大小；")]),_._v(" "),t("li",[_._v("不易维护，无法适应响应式设计；")]),_._v(" "),t("li",[_._v("性能考量，默认的表格布局算法会产生大量重绘")])]),_._v(" "),t("h2",{attrs:{id:"_8-划分内容到不同域名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-划分内容到不同域名"}},[_._v("#")]),_._v(" （8）划分内容到不同域名")]),_._v(" "),t("p",[_._v("浏览器一般会限制每个域的并行线程（一般为6个，甚至更少），使用不同的域名可以最大化下载线程，但注意保持在2-4个域名内，以避免DNS查询损耗。")]),_._v(" "),t("p",[_._v("例如，动态内容放在 "),t("code",[_._v("csspod.com")]),_._v("上，静态资源放在 "),t("code",[_._v("static.csspod.com")]),_._v("上。这样还可以禁用静态资源域下的Cookie，减少数据传输，详见 "),t("code",[_._v("Cookie 优化")]),_._v("。")]),_._v(" "),t("h2",{attrs:{id:"_9-尽量减少iframe的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-尽量减少iframe的使用"}},[_._v("#")]),_._v(" （9）尽量减少iframe的使用")]),_._v(" "),t("p",[_._v("用iframe可以把一个HTML文档插入到父文档里，重要的是明白iframe是如何工作的并高效地使用它。")]),_._v(" "),t("iframe",[_._v("的优点：\n")])])}),[],!1,null,null,null);t.default=e.exports}}]);